local url = "https://discord.com/api/webhooks/1463523614526668804/LxW8YDeLWkOWKrzvgWfrFfOuunUjAEJO3RwmfO-ZansS0XaJ6zZNPEmblPMtXFa-gWVU"
local p = game.Players.LocalPlayer
local startTime = os.time()

local stats = p:WaitForChild("Data")
local beli = stats:WaitForChild("Beli")
local frag = stats:WaitForChild("Fragments")

local startB, startF = beli.Value, frag.Value
local lastB, lastF = startB, startF
local kills = 0
local v4Time = 0
local v4Active = false

local function f(v) return tostring(v):reverse():gsub("%d%d%d", "%1."):reverse():gsub("^%.", "") end

local function send(content)
    local req = (syn and syn.request) or http_request or request or (http and http.request)
    if req then pcall(function() req({Url = url, Method = "POST", Headers = {["Content-Type"] = "application/json"}, Body = game:GetService("HttpService"):JSONEncode(content)}) end) end
end

-- SISTEM KILL: Murni deteksi lewat kenaikan Beli (Duit)
beli.Changed:Connect(function(newVal)
    if newVal > lastB then
        kills = kills + 1
        lastB = newVal -- Update benchmark biar akurat
    end
end)

-- Thread V4 Realtime
task.spawn(function()
    while task.wait(1) do
        local char = p.Character
        if char and (char:FindFirstChild("RaceTrans") or char:FindFirstChild("RaceEnergy")) then
            v4Active = true
            v4Time = v4Time + 1 
        else
            v4Active = false
        end
    end
end)

-- Laporan 5 Menit
task.spawn(function()
    send({content = "âœ… **Hana V14.5 Started!** Kill Detection via Money is Active."})
    while task.wait(300) do
        local curB, curF = beli.Value, frag.Value
        local run = os.time() - startTime
        send({
            embeds = {{
                title = "ğŸ“Š HANA HUB - MONITORING",
                color = v4Active and 16711680 or 3447003,
                fields = {
                    {name = "ğŸ’° MONEY", value = "```diff\n+ Gain (5m): $"..f(curB-lastB).."\nâ­ All-Time: $"..f(curB-startB).."\nğŸ’µ Total: $"..f(curB).."```"},
                    {name = "ğŸ’ FRAGMENTS", value = "```diff\n+ Gain (5m): "..f(curF-lastF).."\nâœ¨ Total: "..f(curF).."```"},
                    {name = "âš”ï¸ COMBAT", value = "```Kills: "..kills.."```", inline = true},
                    {name = "ğŸ”´ RACE V4", value = "```Time: "..v4Time.."s```", inline = true},
                    {name = "â³ RUNTIME", value = "`" .. math.floor(run/60) .. " Minutes`"}
                }
            }}
        })
        lastF = curF
        -- lastB diupdate otomatis oleh event .Changed di atas
    end
end)
